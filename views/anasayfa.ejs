<!DOCTYPE html>
<html lang="en">

<head>
    <script src="/public/js/ansayfa.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anasayfa</title>
    <link rel="stylesheet" href="/public/css/Anasayfa.css">
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
    <!-- Boxicons kütüphanesi -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js kütüphanesi -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.0.0"></script>
    <!-- Zoom Plugin -->
</head>

<body>
    <nav>
        <ul class="left-menu">
            <li><a href="#" id="homeLink">HOME</a></li>
            <li><a href="#" id="cryptoLink">CRYPTO</a></li>
            <li><a href="#" id="stockLink">STOCK</a></li>
            <li><a href="#" id="commodityLink">COMMODITY</a></li>
            <li><a href="#" id="cashLink">CASH & EQUIVALENTS</a></li>
            <!-- CRYPTOV2 Başlığı -->
            <li class="dropdown">
                <a href="#" id="cryptov2Link">CRYPTOV2</a>
                <ul class="dropdown-content">
                    <li><a href="#" id="spotLink">SPOT</a></li>
                    <li><a href="#" id="futureLink">FUTURE</a></li>
                </ul>
            </li>
        </ul>
        <div class="right-menu">
            <a href="#" class="user-icon" onclick="toggleDropdown()">
                <i class='bx bx-user'></i>
            </a>
            <% if (username) { %>
                <span class="username-text">
                    <%= username %>
                </span>
            <% } %>
            <div class="dropdown-content" id="dropdownContent">
                <a href="#" onclick="openSettingsModal()">Settings</a>
                <a href="#" onclick="openMyAccountModal()">My Account</a>
                <a href="#" id="logoutLink">Log Out</a>
            </div>
        </div>
    </nav>

    <!-- Tema geçiş butonu -->
    <button id="toggleMode">Toggle Mode</button>

    <!-- Bilgi kutucuğu -->
    <div id="infoBox" class="info-box" style="display:none;"></div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2>Settings</h2>
            <form>
                <label for="username">Username:</label>
                <input type="text" id="username" name="username">
                <br>
                <label for="email">Email:</label>
                <input type="email" id="email" name="email">
                <br>
                <button type="submit">Save</button>
            </form>
            <span class="close" onclick="closeSettingsModal()">&times;</span>
        </div>
    </div>

    <!-- My Account Modal -->
    <div id="myAccountModal" class="modal">
        <div class="modal-content">
            <h2>MY ACCOUNT</h2>
            <canvas id="myAccountChart"></canvas>
            <span class="close" onclick="closeMyAccountModal()">&times;</span>
        </div>
    </div>

    <!-- Dinamik fiyat kaydırma kutusu -->
    <div class="price-ticker">
        <div class="ticker-content" id="tickerContent">
            <!-- Dinamik olarak fiyatlar buraya eklenecek -->
        </div>
    </div>

    <!-- CRYPTO Tablosu - Başlangıçta gizli -->
    <div id="cryptoTable" class="crypto-table" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Crypto</th>
                    <th>Spot</th>
                    <th>Future</th>
                    <th>Total Position</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>BTC</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>ETH</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>LINK</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>PENDLE</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>INJ</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>SFP</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>LPT</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- STOCK Tablosu - Başlangıçta gizli -->
    <div id="stockTable" class="stock-table" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Stock</th>
                    <th>Spot</th>
                    <th>Future</th>
                    <th>Total Position</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>PLNTR</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>META</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>TSLA</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- COMMODITY Tablosu - Başlangıçta gizli -->
    <div id="commodityTable" class="commodity-table" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Commodity</th>
                    <th>Spot</th>
                    <th>Future</th>
                    <th>Total Position</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>XAG</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>XAU</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- CASH & EQUIVALENTS Tablosu - Başlangıçta gizli -->
    <div id="cashTable" class="cash-table" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Cash & Equivalents</th>
                    <th>Spot</th>
                    <th>Future</th>
                    <th>Total Position</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>USDT</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>USD</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- SPOT Tablosu - Başlangıçta gizli -->
    <div id="spotTable" class="spot-table" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Symbol</th>
                    <th>Type</th>
                    <th>Side</th>
                    <th>Price</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // CRYPTO, STOCK, COMMODITY ve CASH tablolarını birbirinden bağımsız aç/kapat
        document.getElementById('cryptoLink').addEventListener('click', function () {
            var cryptoTable = document.getElementById('cryptoTable');
            var stockTable = document.getElementById('stockTable');
            var commodityTable = document.getElementById('commodityTable');
            var cashTable = document.getElementById('cashTable');
            var spotTable = document.getElementById('spotTable');
            cryptoTable.style.display = "block";  // CRYPTO tablosunu göster
            stockTable.style.display = "none";   // STOCK tablosunu gizle
            commodityTable.style.display = "none"; // COMMODITY tablosunu gizle
            cashTable.style.display = "none"; // CASH tablosunu gizle
            spotTable.style.display = "none"; // SPOT tablosunu gizle
        });

        document.getElementById('stockLink').addEventListener('click', function () {
            var stockTable = document.getElementById('stockTable');
            var cryptoTable = document.getElementById('cryptoTable');
            var commodityTable = document.getElementById('commodityTable');
            var cashTable = document.getElementById('cashTable');
            var spotTable = document.getElementById('spotTable');
            stockTable.style.display = "block";  // STOCK tablosunu göster
            cryptoTable.style.display = "none";   // CRYPTO tablosunu gizle
            commodityTable.style.display = "none"; // COMMODITY tablosunu gizle
            cashTable.style.display = "none"; // CASH tablosunu gizle
            spotTable.style.display = "none"; // SPOT tablosunu gizle
        });

        document.getElementById('commodityLink').addEventListener('click', function () {
            var commodityTable = document.getElementById('commodityTable');
            var stockTable = document.getElementById('stockTable');
            var cryptoTable = document.getElementById('cryptoTable');
            var cashTable = document.getElementById('cashTable');
            var spotTable = document.getElementById('spotTable');
            commodityTable.style.display = "block";  // COMMODITY tablosunu göster
            stockTable.style.display = "none";   // STOCK tablosunu gizle
            cryptoTable.style.display = "none";  // CRYPTO tablosunu gizle
            cashTable.style.display = "none"; // CASH tablosunu gizle
            spotTable.style.display = "none"; // SPOT tablosunu gizle
        });

        document.getElementById('cashLink').addEventListener('click', function () {
            var cashTable = document.getElementById('cashTable');
            var stockTable = document.getElementById('stockTable');
            var cryptoTable = document.getElementById('cryptoTable');
            var commodityTable = document.getElementById('commodityTable');
            var spotTable = document.getElementById('spotTable');
            cashTable.style.display = "block";  // CASH tablosunu göster
            stockTable.style.display = "none";   // STOCK tablosunu gizle
            cryptoTable.style.display = "none";  // CRYPTO tablosunu gizle
            commodityTable.style.display = "none";  // COMMODITY tablosunu gizle
            spotTable.style.display = "none"; // SPOT tablosunu gizle
        });

        // Spot linkine tıklandığında sadece SPOT tablosunu göster
        document.getElementById('spotLink').addEventListener('click', function () {
            var spotTable = document.getElementById('spotTable');
            var cryptoTable = document.getElementById('cryptoTable');
            var stockTable = document.getElementById('stockTable');
            var commodityTable = document.getElementById('commodityTable');
            var cashTable = document.getElementById('cashTable');
            spotTable.style.display = "block";  // SPOT tablosunu göster
            cryptoTable.style.display = "none";   // CRYPTO tablosunu gizle
            stockTable.style.display = "none";   // STOCK tablosunu gizle
            commodityTable.style.display = "none"; // COMMODITY tablosunu gizle
            cashTable.style.display = "none"; // CASH tablosunu gizle
        });

        // HOME linkine basıldığında sayfa yenilensin
        document.getElementById('homeLink').addEventListener('click', function () {
            location.reload(); // Sayfayı yeniler
        });

        // Dropdown toggle fonksiyonu
        function toggleDropdown() {
            var dropdown = document.getElementById("dropdownContent");
            if (dropdown.style.display === "block") {
                dropdown.style.display = "none";
            } else {
                dropdown.style.display = "block";
            }
        }

        // Modal fonksiyonları
        function openSettingsModal() {
            document.getElementById("settingsModal").style.display = "flex";
        }

        function closeSettingsModal() {
            document.getElementById("settingsModal").style.display = "none";
        }

        function openMyAccountModal() {
            document.getElementById("myAccountModal").style.display = "flex";
        }

        function closeMyAccountModal() {
            document.getElementById("myAccountModal").style.display = "none";
        }

        // Binance fiyatları güncelleme
        const btcWebSocket = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@trade');
        const ethWebSocket = new WebSocket('wss://stream.binance.com:9443/ws/ethusdt@trade');
        const linkWebSocket = new WebSocket('wss://stream.binance.com:9443/ws/linkusdt@trade');
        const pendleWebSocket = new WebSocket('wss://stream.binance.com:9443/ws/pendleusdt@trade');
        const injWebSocket = new WebSocket('wss://stream.binance.com:9443/ws/injusdt@trade');
        const sfpWebSocket = new WebSocket('wss://stream.binance.com:9443/ws/sfpusdt@trade');
        const lptWebSocket = new WebSocket('wss://stream.binance.com:9443/ws/lptusdt@trade');

        // BTC fiyatlarını dinlemek
        btcWebSocket.onmessage = function (event) {
            const btcData = JSON.parse(event.data);
            const btcPrice = parseFloat(btcData.p).toFixed(2);
            updateTickerPrice('BTC', btcPrice);
        };

        // ETH fiyatlarını dinlemek
        ethWebSocket.onmessage = function (event) {
            const ethData = JSON.parse(event.data);
            const ethPrice = parseFloat(ethData.p).toFixed(2);
            updateTickerPrice('ETH', ethPrice);
        };

        // LINK fiyatlarını dinlemek
        linkWebSocket.onmessage = function (event) {
            const linkData = JSON.parse(event.data);
            const linkPrice = parseFloat(linkData.p).toFixed(2);
            updateTickerPrice('LINK', linkPrice);
        };

        // PENDLE fiyatlarını dinlemek
        pendleWebSocket.onmessage = function (event) {
            const pendleData = JSON.parse(event.data);
            const pendlePrice = parseFloat(pendleData.p).toFixed(2);
            updateTickerPrice('PENDLE', pendlePrice);
        };

        // INJ fiyatlarını dinlemek
        injWebSocket.onmessage = function (event) {
            const injData = JSON.parse(event.data);
            const injPrice = parseFloat(injData.p).toFixed(2);
            updateTickerPrice('INJ', injPrice);
        };

        // SFP fiyatlarını dinlemek
        sfpWebSocket.onmessage = function (event) {
            const sfpData = JSON.parse(event.data);
            const sfpPrice = parseFloat(sfpData.p).toFixed(2);
            updateTickerPrice('SFP', sfpPrice);
        };

        // LPT fiyatlarını dinlemek
        lptWebSocket.onmessage = function (event) {
            const lptData = JSON.parse(event.data);
            const lptPrice = parseFloat(lptData.p).toFixed(2);
            updateTickerPrice('LPT', lptPrice);
        };

        // Fiyatları ticker'a ekleyen fonksiyon
        function updateTickerPrice(symbol, price) {
            const tickerContent = document.getElementById('tickerContent');
            let existingElement = document.querySelector('.price-item.' + symbol);

            if (existingElement) {
                existingElement.textContent = symbol + ': $' + price;
            } else {
                const priceElement = document.createElement('span');
                priceElement.className = 'price-item ' + symbol;
                priceElement.textContent = symbol + ': $' + price;
                tickerContent.appendChild(priceElement);
            }
        }

        // Tema değiştirici
        document.getElementById('toggleMode').addEventListener('click', function () {
            document.body.classList.toggle('light-mode');
            let theme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
            localStorage.setItem('theme', theme);
        });

        // Sayfa yüklendiğinde seçilen tema yüklenir
        window.onload = function () {
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-mode');
            }
        };
    </script>
</body>

</html>
